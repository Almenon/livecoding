/* Author:
	Gabriel Florit
*/var aigua=function(){var e=null;return{askBeforeNew:function(){var e=aigua.isDirty()?confirm(aigua.areYouSureText):!0;if(e){aigua.resetScreen();aigua.resetUrl();aigua.resetMenu();aigua.currentGistUserId==aigua.user.id&&$('#menu li:contains("save as public gist"), #menu li:contains("save as private gist")').removeClass("disabled")}},comment:function(e){aigua.masterComment(e,!0)},createPostDataObject:function(){var e={},t=aigua.modes[aigua.currentModeIndex].name;_.each(aigua.modes,function(n,r,i){var s=n.name;t==s?e[s]=aigua.codeMirror.getValue():e[s]=_.find(aigua.modes,function(e){return e.name==s}).code});var n=$('li[class*="selected"]',$('#menu .item h2:contains("libraries")').next()),r={libraries:_.map(n,function(e){return $(e).text()}),mode:aigua.modes[aigua.currentModeIndex].name,layout:aigua.screenLayouts[aigua.currentScreenLayoutIndex]};r.resolution!="reset"&&(r.resolution=$('li[class*="disabled"]',$('#menu .item h2:contains("resolution")').next()).text());e.options=JSON.stringify(r,null,4);return e},getOAuthToken:function(){return e},getSelectedRange:function(e){var t={from:e.getCursor(!0),to:e.getCursor(!1)};return t},getUrlGistId:function(){var e=document.createElement("a");e.href=location.href;var t=e.pathname.split("/")[1];return t.length>0&&t!="!"?t:null},getUrlGistVersionId:function(){var e=document.createElement("a");e.href=location.href;var t=e.pathname.split("/");return t.length==3?t[2]:null},hidePopup:function(){$("#popup .about").is(":visible")&&(localStorage.livecoding_about=$("#popup .about").attr("rel"));$("#popup .containerItem").fadeOut();$("#popup").fadeOut()},isDirty:function(){return $(".dirty").css("visibility")=="visible"},isHexString:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},loadGist:function(e,t){aigua.isLoading=!0;aigua.resetScreen();aigua.resetMenu();aigua.setToClean();var n="https://api.github.com/gists/"+e+(t?"/"+t:"");$.ajax({url:n+"?callback=?",dataType:"json",success:function(n){aigua.currentGistUserId=n.data.user?n.data.user.id:null;var r=n.data.files["water.html"],i=n.data.files["water.js"],s=n.data.files["water.css"],o=n.data.files["water.json"],u;n.data.files["options.json"]?u=JSON.parse(n.data.files["options.json"].content):u={libraries:[]};u.mode||(u.mode=aigua.modes[0].name);u.layout||(u.layout=aigua.screenLayouts[2]);!u.resolution||u.resolution.indexOf("(")!=-1?u.resolution=$("li:first",$('#menu .item h2:contains("resolution")').next()):u.resolution=$('li:contains("'+u.resolution+'")',$('#menu .item h2:contains("resolution")').next());aigua.switchLayout(u.layout);aigua.switchResolution(u.resolution);_.each(u.libraries,function(e){var t=e;frames[0].livecoding.addJs(_.find(aigua.libraries,function(e){return e.name==t}));$(_.find($("li",$('#menu .item h2:contains("libraries")').next()),function(e){return $(e).text()==t})).addClass("selected")});aigua.switchMode("json",!0);o&&aigua.codeMirror.setValue(o.content);aigua.switchMode("css",!0);s&&aigua.codeMirror.setValue(s.content);aigua.switchMode("html",!0);r&&aigua.codeMirror.setValue(r.content);aigua.switchMode("javascript");if(i){aigua.codeMirror.setValue(i.content);aigua.codeMirror.setValue(i.content)}aigua.switchMode(u.mode);aigua.setUrl(e,t);aigua.isLoading=!1;if(aigua.currentGistUserId==aigua.user.id){$('#menu li:contains("save as '+(/^\d+$/g.test(e)?"public":"private")+' gist")').removeClass("disabled");$('#menu li:contains("save as '+(/^\d+$/g.test(e)?"private":"public")+' gist")').addClass("disabled")}}})},logIn:function(t,n){e=t;localStorage["aigua.token"]=e;aigua.resetMenu();$.get("/user/"+e,function(e){aigua.user=JSON.parse(e);var t=$("#controls .item h2.user");t.css("background-image","url("+aigua.user.avatar_url+")");t.css("cursor","pointer");t.click(function(e){window.open(aigua.user.html_url);aigua.resetMenu()});$('li:contains("login")').text("logout");$('#menu li:contains("save as private gist"), #menu li:contains("save as public gist")').removeClass("disabled");n()})},logOut:function(){e=null;aigua.user=null;localStorage.removeItem("aigua.token");aigua.resetMenu();var t=$("#controls .item h2.user");t.removeAttr("style");t.unbind("click");$('li:contains("logout")').text("login");$('#menu li:contains("save as private gist"), #menu li:contains("save as public gist")').addClass("disabled")},masterComment:function(e,t){var n=aigua.getSelectedRange(e);e.commentRange(t,n.from,n.to)},modifyNumber:function(e,t){var n,r,i,s,o;n=e.toExponential().split("e");r=Number(n[1]);r-=1;i=Math.pow(10,r);s=e+t*i;o=(i.toString().split(".")[1]||"").length;return d3.round(s,o)},pauseResumeExecution:function(){if(!aigua.pauseExecution){aigua.pauseExecution=!aigua.pauseExecution;$("#pauseExecution").show()}else{aigua.pauseExecution=!aigua.pauseExecution;$("#pauseExecution").hide();aigua.renderCode()}},renderCode:function(){if(!aigua.pauseExecution){var e=aigua.codeMirror.getValue();switch(aigua.modes[aigua.currentModeIndex].name){case"html":$("body #livecoding-main",$("iframe").contents()).html(e);frames[0].livecoding.renderCode(_.find(aigua.modes,function(e){return e.name=="javascript"}).code||"");break;case"javascript":$("body #livecoding-main",$("iframe").contents()).html(_.find(aigua.modes,function(e){return e.name=="html"}).code||"");frames[0].livecoding.renderCode(e);break;case"css":$("#style",$("iframe").contents()).get(0).textContent=e;$("body #livecoding-main",$("iframe").contents()).html(_.find(aigua.modes,function(e){return e.name=="html"}).code||"");frames[0].livecoding.renderCode(_.find(aigua.modes,function(e){return e.name=="javascript"}).code||"");break;case"json":if(e.length>0)try{frames[0].livecoding.json=JSON.parse(e);$("body #livecoding-main",$("iframe").contents()).html(_.find(aigua.modes,function(e){return e.name=="html"}).code||"");frames[0].livecoding.renderCode(_.find(aigua.modes,function(e){return e.name=="javascript"}).code||"")}catch(t){console.log(t)}finally{}}}},replaceSnippet:function(e){var t=e.getCursor(),n=t.line,r=t.ch,i=e.getTokenAt({line:n,ch:r}),s=_.find(aigua.snippets,function(e){return e.keyword==i.string});s&&aigua.modes[aigua.currentModeIndex].name==s.mode&&e.replaceRange(s.snippet,{line:n,ch:r-i.string.length},{line:n,ch:r})},resetBar:function(e){aigua.bar.width(aigua.startingBarWidth);aigua.bar.css("left",e-aigua.startingBarWidth/2-aigua.borderWidth);aigua.filler.removeClass("filler-edge-left");aigua.filler.removeClass("filler-edge-right")},resetMenu:function(){var e=$("#menu");$("ul",e).hide();$("h2",e).removeClass("hover")},resetScreen:function(){_.each(aigua.modes,function(e,t,n){aigua.switchMode(e.name,!0);aigua.codeMirror.setValue("")});$("li",$('#menu .item h2:contains("libraries")').next()).removeClass("selected");_.each(aigua.libraries,function(e){frames[0].livecoding.removeJs(_.find(aigua.libraries,function(t){return t.name==e.name}))});aigua.switchMode("html")},resetUrl:function(){history.pushState(null,null,"/!");$("#gist").attr("href","");$("#gist").html("")},respondToKey:function(e){var t,n,r="";if(!aigua.slider.is(":visible")&&!$(aigua.miniColorsSelector).is(":visible")){t=e.getCursor();n=e.getTokenAt(t);(n.className=="number"||n.className=="cm-number")&&aigua.showSlider(e,t,n);if(n.string.length>1){switch(aigua.modes[aigua.currentModeIndex].name){case"javascript":r=n.string.substring(1,n.string.length-1);aigua.currentSelectionStart={line:t.line,ch:n.start+1};aigua.currentSelectionEnd={line:t.line,ch:n.end-1};break;case"css":r=n.string;aigua.currentSelectionStart={line:t.line,ch:n.start};aigua.currentSelectionEnd={line:t.line,ch:n.end}}if(!aigua.isHexString(r))return;aigua.showColorSelector(e,r)}}},saveAsUser:function(e){aigua.setToClean();$("#gist").hide();$(".save-confirmation").show();$(".save-confirmation").text("saving...");var t="",n=aigua.createPostDataObject();n.token=aigua.getOAuthToken();if(!aigua.getUrlGistId())t="/create-new?public="+e;else{n.id=aigua.getUrlGistId();!aigua.currentGistUserId||aigua.currentGistUserId!=aigua.user.id?t="/fork?public="+e:t="/save"}$.post(t,n,function(t){aigua.setUrl(t);aigua.currentGistUserId=aigua.user.id;aigua.showSaveConfirmation();$('#menu li:contains("save as '+(e?"private":"public")+' gist")').addClass("disabled");$('#menu li:contains("save as '+(e?"public":"private")+' gist")').removeClass("disabled")})},saveAnonymously:function(){aigua.setToClean();$("#gist").hide();$(".save-confirmation").show();$(".save-confirmation").text("saving...");var e=aigua.createPostDataObject();$.post("/save-anonymously",e,function(e){aigua.setUrl(e);aigua.currentGistUserId=null;aigua.showSaveConfirmation();$('#menu li:contains("save as public gist"), #menu li:contains("save as private gist")').removeClass("disabled")})},saveAsUserOrAnonymously:function(){localStorage["aigua.token"]?aigua.saveAsUser(!0):aigua.saveAnonymously()},setToClean:function(){$(".dirty").css("visibility","hidden")},setToDirty:function(){$(".dirty").css("visibility","visible")},setUrl:function(e,t){var n="/"+e+(t?"/"+t:"");history.pushState(null,null,n);var r="https://gist.github.com";gistUrl=r+n;$("#gist").attr("href",gistUrl);$("#gist").html(gistUrl)},showColorSelector:function(e,t){var n,r,i;if(aigua.pulseColors){window.clearInterval(aigua.pulseColorsInterval);window.clearInterval(aigua.pulseMessageInterval);$("#message").hide();aigua.pulseColors=!1}e.setSelection(aigua.currentSelectionStart,aigua.currentSelectionEnd);aigua.miniColorsTrigger.click();$("#hidden-miniColors").miniColors("value",t.substring(1));n=e.cursorCoords(!0);r=e.cursorCoords(!1);i=n.x+(r.x-n.x)/2;$(aigua.miniColorsSelector).css("left",i-$(aigua.miniColorsSelector).width()/2);$(aigua.miniColorsSelector).css("top",r.y+aigua.lineHeight)},showSaveConfirmation:function(){$(".save-confirmation").text("saved at "+(new Date).toLocaleTimeString());$(".save-confirmation").fadeOut(1500,function(){$("#gist").fadeIn(250)})},showSlider:function(e,t,n){var r,i,s,o,u="";if(aigua.pulseNumbers){window.clearInterval(aigua.pulseNumbersInterval);window.clearInterval(aigua.pulseMessageInterval);$("#message").hide();aigua.pulseNumbers=!1}aigua.slider.show();_.each(["px","em","%"],function(e){n.string.indexOf(e)!=-1&&(u=e)});aigua.originalNumber==null&&(aigua.originalNumber={value:Number(n.string.replace(u,"")),suffix:u});aigua.currentSelectionStart={line:t.line,ch:n.start};aigua.currentSelectionEnd={line:t.line,ch:n.end};e.setSelection(aigua.currentSelectionStart,aigua.currentSelectionEnd);r=e.cursorCoords(!0);i=e.cursorCoords(!1);s=r.x+(i.x-r.x)/2;aigua.marker.css("left",s);aigua.handle.css("left",s-aigua.handle.width()/2);aigua.bar.css("left",s-aigua.bar.width()/2-aigua.borderWidth);aigua.bar.css("top",r.y-aigua.lineHeight);aigua.triangle.css("left",s-aigua.triangleWidth);aigua.triangle.css("top",aigua.bar.offset().top+aigua.bar.height()+aigua.borderWidth*2);aigua.ball.offset({top:aigua.filler.offset().top})},startAnimate:function(){frames[0].livecoding.startAnimate();$("#startAnimation").show()},stopAnimate:function(){frames[0].livecoding.stopAnimate();$("#startAnimation").hide()},switchLayout:function(e){var t=$(".screenLayout");t.siblings(".screenLayout").removeClass("disabled");$('.screenLayout:contains("'+e+'")').addClass("disabled");aigua.currentScreenLayoutIndex=_.indexOf(aigua.screenLayouts,e);aigua.updateScreenLayout();aigua.resetMenu()},switchMode:function(e,t){aigua.pause=!0;if(!t){$("#modes h2").not(":contains('"+e+"')").addClass("passive");$("#modes h2").not(":contains('"+e+"')").removeClass("active");$("#modes h2:contains('"+e+"')").addClass("active");$("#modes h2:contains('"+e+"')").removeClass("passive")}aigua.modes[aigua.currentModeIndex].code=aigua.codeMirror.getValue();aigua.modes[aigua.currentModeIndex].cursor=aigua.codeMirror.getCursor();aigua.modes[aigua.currentModeIndex].scrollInfo=aigua.codeMirror.getScrollInfo();aigua.currentModeIndex=_.indexOf(_.pluck(aigua.modes,"name"),e);aigua.codeMirror.setValue(aigua.modes[aigua.currentModeIndex].code||"");aigua.modes[aigua.currentModeIndex].cursor&&aigua.codeMirror.setCursor(aigua.modes[aigua.currentModeIndex].cursor);aigua.modes[aigua.currentModeIndex].scrollInfo&&aigua.codeMirror.scrollTo(aigua.modes[aigua.currentModeIndex].scrollInfo.x,aigua.modes[aigua.currentModeIndex].scrollInfo.y);aigua.codeMirror.focus();var n,r;if(aigua.modes[aigua.currentModeIndex].name=="json"){n="application/json";r="javascript"}else if(aigua.modes[aigua.currentModeIndex].name=="html"){n="text/html";r="htmlmixed"}else{n=aigua.modes[aigua.currentModeIndex].name;r=aigua.modes[aigua.currentModeIndex].name}$(".CodeMirror-gutter-text pre").removeClass("codeFolded");aigua.codeMirror.setOption("mode",n);CodeMirror.autoLoadMode(aigua.codeMirror,r);aigua.pause=!1},switchToCss:function(){aigua.switchMode("css")},switchToHtml:function(){aigua.switchMode("html")},switchToJavaScript:function(){aigua.switchMode("javascript")},switchToJson:function(){aigua.switchMode("json")},switchToNextLayout:function(){aigua.currentScreenLayoutIndex==aigua.screenLayouts.length-1?aigua.switchLayout(aigua.screenLayouts[0]):aigua.switchLayout(aigua.screenLayouts[aigua.currentScreenLayoutIndex+1])},switchToPreviousLayout:function(){aigua.currentScreenLayoutIndex==0?aigua.switchLayout(aigua.screenLayouts[aigua.screenLayouts.length-1]):aigua.switchLayout(aigua.screenLayouts[aigua.currentScreenLayoutIndex-1])},switchResolution:function(e){e.siblings().removeClass("disabled");e.addClass("disabled");if(e.text()=="reset"){$("iframe").css("width","");$("iframe").css("height","");$("iframe").css("border","")}else{width=e.attr("rel").split("x")[0];height=e.attr("rel").split("x")[1];$("iframe").css("width",width);$("iframe").css("height",height);$("iframe").css("border","solid gray 1px");while($("html",$("iframe").contents()).width()!=width)$("iframe").css("width",$("iframe").width()+1)}aigua.renderCode();aigua.resetMenu()},uncomment:function(e){aigua.masterComment(e,!1)},updateScreenLayout:function(){if(aigua.screenLayouts[aigua.currentScreenLayoutIndex]=="sketchpad mode")$("body").find("*").removeClass("full horizontal");else{$("body").find("*").addClass("full");aigua.screenLayouts[aigua.currentScreenLayoutIndex]=="fullscreen mode (horizontal)"?$("body").find("*").addClass("horizontal"):$("body").find("*").removeClass("horizontal")}switch(aigua.modes[aigua.currentModeIndex].name){case"html":aigua.renderCode();aigua.switchMode("css",!0);aigua.switchMode("html",!0);break;case"javascript":aigua.renderCode();aigua.switchMode("css",!0);aigua.switchMode("javascript",!0);break;case"css":aigua.switchMode("javascript",!0);aigua.renderCode();aigua.switchMode("css",!0);break;case"json":aigua.renderCode();aigua.switchMode("javascript",!0);aigua.switchMode("json",!0)}},areYouSureText:"Are you sure? You will lose any unsaved changes.",ball:null,bar:null,borderWidth:2,currentGistUserId:null,miniColorsSelector:".miniColors-selector",miniColorsTrigger:null,currentModeIndex:0,currentScreenLayoutIndex:2,currentSelection:null,filler:null,handle:null,iframeLoaded:null,isLoading:null,key:null,libraries:[{name:"crossfilter",obj:"crossfilter"},{name:"d3",obj:"d3"},{name:"iScroll",obj:"iScroll"},{name:"Handlebars",obj:"Handlebars"},{name:"Highcharts",obj:"Highcharts"},{name:"KineticJS",obj:"Kinetic"},{name:"jQuery.Flickable",obj:"$.fn.flickable"},{name:"jQuery.TouchSwipe",obj:"$.fn.swipe"},{name:"Leaflet",obj:"L"},{name:"Raphael",obj:"Raphael"},{name:"SwipeView",obj:"SwipeView"},{name:"Processing",obj:"Processing"},{name:"three.js",obj:"THREE"},{name:"TopoJSON",obj:"topojson"},{name:"Underscore",obj:"_"}],lineHeight:19,marker:null,modes:[{name:"html",code:null,cursor:null,scrollInfo:null},{name:"javascript",code:null,cursor:null,scrollInfo:null},{name:"css",code:null,cursor:null,scrollInfo:null},{name:"json",code:null,cursor:null,scrollInfo:null}],originalNumber:null,pause:!1,pauseExecution:!1,pulseColors:!0,pulseColorsInterval:null,pulseMessageInterval:null,pulseNumbers:!0,pulseNumbersInterval:null,screenLayouts:["fullscreen mode (horizontal)","fullscreen mode (vertical)","sketchpad mode"],slider:null,snippets:[{keyword:"bor",snippet:"border: solid #FF0000 1px;",mode:"css"},{keyword:"bac",snippet:"background: #FF0000;",mode:"css"},{keyword:"mar",snippet:"margin: 0em 0em 0em 0em;",mode:"css"},{keyword:"pad",snippet:"padding: 0em 0em 0em 0em;",mode:"css"},{keyword:"each",snippet:".each(function(v, i) {})",mode:"javascript"},{keyword:"map",snippet:".map(function(v, i) {})",mode:"javascript"},{keyword:"find",snippet:".find(function(v, i) {})",mode:"javascript"},{keyword:"filter",snippet:".filter(function(v, i) {})",mode:"javascript"},{keyword:"reject",snippet:".reject(function(v, i) {})",mode:"javascript"},{keyword:"sort",snippet:".sortBy(function(v, i) {})",mode:"javascript"},{keyword:"group",snippet:".groupBy(function(v, i) {})",mode:"javascript"},{keyword:"count",snippet:".countBy(function(v, i) {})",mode:"javascript"}],startingBarWidth:300,triangle:null,triangleHeight:5,triangleWidth:12,user:null}}();$(function(){$("#main").fadeIn(1e3);aigua.iframeLoaded=function(){if(BrowserDetect.browser!="Chrome"&&BrowserDetect.browser!="Firefox"&&BrowserDetect.browser!="Safari")$("#browsermessage").fadeIn(1e3);else{if(!localStorage.livecoding_about||localStorage.livecoding_about!=$("#popup .about").attr("rel")){$("#popup").fadeIn();$("#popup .about").fadeIn()}var e={};aigua.key={};var t=[];if(BrowserDetect.OS=="Mac"){aigua.key.Name="Alt-Alt";aigua.key.DisplayName="Alt";aigua.key.Code=18;e["Alt-S"]=aigua.saveAsUserOrAnonymously;e["Cmd-/"]=aigua.comment;e["Cmd-."]=aigua.uncomment;e["Cmd-1"]=aigua.switchToHtml;e["Cmd-2"]=aigua.switchToJavaScript;e["Cmd-3"]=aigua.switchToCss;e["Cmd-4"]=aigua.switchToJson;e["Cmd-'"]=aigua.switchToPreviousLayout;e["Cmd-;"]=aigua.switchToNextLayout;e.Tab=aigua.replaceSnippet;e["Cmd-\\"]=aigua.pauseResumeExecution;e["Cmd-9"]=aigua.startAnimate;e["Cmd-0"]=aigua.stopAnimate;t=[{section:"general",shortcuts:[{shortcut:"Alt + S",name:"save document"},{shortcut:"⌘ + /",name:"comment selection"},{shortcut:"⌘ + .",name:"uncomment selection"},{shortcut:"⌘ + \\",name:"pause/resume execution"},{shortcut:"⌘ + 9",name:"start animation"},{shortcut:"⌘ + 0",name:"stop animation"}]},{section:"modes",shortcuts:[{shortcut:"⌘ + 1",name:"html"},{shortcut:"⌘ + 2",name:"javascript"},{shortcut:"⌘ + 3",name:"css"},{shortcut:"⌘ + 4",name:"json"}]},{section:"layouts",shortcuts:[{shortcut:"⌘ + '",name:"next layout"},{shortcut:"⌘ + ;",name:"previous layout"}]}]}if(BrowserDetect.OS=="Linux"){aigua.key.Name="Ctrl";aigua.key.DisplayName="Ctrl";aigua.key.Code=17;e["Ctrl-S"]=aigua.saveAsUserOrAnonymously}if(BrowserDetect.OS=="Windows"){aigua.key.Name="Ctrl-Ctrl";aigua.key.DisplayName="Ctrl";aigua.key.Code=17;e["Ctrl-S"]=aigua.saveAsUserOrAnonymously;e["Ctrl-/"]=aigua.comment;e["Ctrl-."]=aigua.uncomment;e["Ctrl-1"]=aigua.switchToHtml;e["Ctrl-2"]=aigua.switchToJavaScript;e["Ctrl-3"]=aigua.switchToCss;e["Ctrl-4"]=aigua.switchToJson;e["Ctrl-'"]=aigua.switchToPreviousLayout;e["Ctrl-;"]=aigua.switchToNextLayout;e.Tab=aigua.replaceSnippet;t=[{section:"general",shortcuts:[{shortcut:"Ctrl + S",name:"save document"},{shortcut:"Ctrl + /",name:"comment selection"},{shortcut:"Ctrl + .",name:"uncomment selection"}]},{section:"modes",shortcuts:[{shortcut:"Ctrl + 1",name:"html"},{shortcut:"Ctrl + 2",name:"javascript"},{shortcut:"Ctrl + 3",name:"css"},{shortcut:"Ctrl + 4",name:"json"}]},{section:"layouts",shortcuts:[{shortcut:"Ctrl + '",name:"next layout"},{shortcut:"Ctrl + ;",name:"previous layout"}]}]}var n=_.chain(aigua.snippets).groupBy(function(e){return e.mode}).map(function(e){var t=_.map(e,function(e){return{shortcut:e.keyword+" + Tab",name:e.snippet}});return{section:"snippets ("+e[0].mode+")",shortcuts:t}}).each(function(e){t.push(e)});_.each(t,function(e,t){var n=$("<h3></h3>");n.text(e.section);var r=$('<ul class="keys"></ul>');_.each(e.shortcuts,function(e){var t=$("<li></li>"),n=$("<span></span>");n.text(e.shortcut);t.append(n);t.append(e.name);r.append(t)});if(t%2==0){$("#popup .keyboard .left").append(n);$("#popup .keyboard .left").append(r)}else{$("#popup .keyboard .right").append(n);$("#popup .keyboard .right").append(r)}});$("#message .key").text(aigua.key.DisplayName);e[aigua.key.Name]=aigua.respondToKey;$("#hidden-miniColors").miniColors({change:function(e,t){aigua.codeMirror.replaceSelection(e.toUpperCase())}});aigua.ball=$("#ball");aigua.bar=$("#bar");aigua.filler=$("#filler");aigua.handle=$("#handle");aigua.marker=$("#marker");aigua.slider=$("#slider");aigua.triangle=$("#triangle");aigua.miniColorsTrigger=$(".miniColors-trigger");aigua.handle.width(aigua.startingBarWidth);aigua.bar.css("border-width",aigua.borderWidth);aigua.bar.width(aigua.startingBarWidth);aigua.triangle.css("border-width",aigua.triangleHeight+"px "+aigua.triangleWidth+"px 0px "+aigua.triangleWidth+"px");aigua.codeMirror=CodeMirror($("#code").get(0),{onChange:function(e,t){if(!aigua.pause){aigua.isLoading||aigua.setToDirty();aigua.renderCode()}},onGutterClick:CodeMirror.newFoldFunction(CodeMirror.braceRangeFinder),extraKeys:e,lineNumbers:!0,matchBrackets:!0,mode:"javascript",modeURL:"/mode/%N.js",readOnly:!1,theme:"lesser-dark"});var r=function(){var e=aigua.getUrlGistId();$("#message").show();aigua.handle.draggable({axis:"x",drag:function(e,t){var n=t.position.left+aigua.handle.width()/2,r=aigua.marker.offset().left,i=n-r,s;s=aigua.modifyNumber(aigua.originalNumber.value,i);aigua.codeMirror.replaceSelection(String(s)+aigua.originalNumber.suffix);if(i>0){r-aigua.bar.offset().left-aigua.borderWidth>aigua.startingBarWidth/2&&aigua.resetBar(r);aigua.filler.width(i);aigua.filler.css("left",aigua.startingBarWidth/2);if(i>aigua.startingBarWidth/2-6)aigua.bar.width(n-aigua.bar.offset().left+5);else{aigua.resetBar(r);aigua.ball.show()}}else if(i<0){aigua.filler.width(-i);aigua.filler.css("left",aigua.startingBarWidth/2- -i+aigua.borderWidth/2);if(-i>aigua.startingBarWidth/2-6){aigua.filler.css("left",aigua.borderWidth/2+7);aigua.bar.width(-i+aigua.startingBarWidth/2+7);aigua.bar.css("left",n-aigua.borderWidth-7)}else{aigua.resetBar(r);aigua.ball.show()}}else aigua.filler.width(0)}});_.each(aigua.modes,function(e,t){var n=$("<div class='item'></div>"),r=$("<h2></h2>");n.append(r);r.addClass(t==aigua.currentModeIndex?"active":"passive");r.text(e.name);$("#modes").append(n)});_.each(aigua.screenLayouts,function(e,t,n){var r=$("<li />");r.text(e);r.addClass("screenLayout");r.addClass(t==aigua.currentScreenLayoutIndex?"disabled":"");$('#menu .item h2:contains("view")').next().prepend(r)});_.each(aigua.libraries,function(e){var t=$("<li />");t.text(e.name);$('#menu .item h2:contains("libraries")').next().append(t)});if(e){var t=aigua.getUrlGistVersionId();aigua.loadGist(e,t)}else aigua.loadGist($("#menu .item h2:contains('examples') + ul li").eq(2).attr("rel"));$(window).mouseup(function(e){aigua.slider.is(":visible")&&aigua.codeMirror.getSelection()==""&&aigua.codeMirror.setSelection(aigua.currentSelectionStart,aigua.currentSelectionEnd)});$(window).keydown(function(e){e.which==27&&aigua.hidePopup()});$(window).keyup(function(e){if(e.which==aigua.key.Code){if(aigua.slider.is(":visible")){aigua.slider.hide();aigua.filler.width(0);aigua.bar.width(aigua.startingBarWidth);aigua.originalNumber=null}$(aigua.miniColorsSelector).is(":visible")&&$(document).trigger("mousedown")}});$(window).on("resize",function(){aigua.renderCode()});$("#modes .item h2").on("click",function(e){aigua.switchMode($(this).text())});$("#menu .item h2").on("mouseover",function(e){var t=$(this).parents(".item");$("ul",t).show();$(this).addClass("hover");$(this).children().addClass("hover")});$("#menu .item").on("mouseout",function(e){$(e.relatedTarget).parents(".item").get(0)!=$(this).get(0)&&aigua.resetMenu()});$("#menu .item li").on("mouseover",function(e){var t=$(this);(!t.attr("class")||t.attr("class").indexOf("disabled")==-1)&&t.addClass("hover")});$("#menu .item li").on("mouseout",function(e){$(this).removeClass("hover")});$("#header").on("click",function(e){e.preventDefault();aigua.askBeforeNew()});$(window).on("beforeunload",function(){if(aigua.isDirty())return aigua.areYouSureText});$("#menu .item ul li").on("click",function(e){e.preventDefault();var t=$(this),n=$("h2",t.parents(".item")).text(),r,i,s;switch(t.text()){case"login":open("/github-login","popup","width=1015,height=500");break;case"logout":aigua.logOut()}switch(n){case"file":switch(t.text()){case"new":aigua.askBeforeNew();break;case"save as public gist":aigua.user?$(this).attr("class").indexOf("disabled")!=-1?alert("You cannot save a private gist as public."):aigua.saveAsUser(!0):alert("Please login to save your work under your GitHub username.");aigua.resetMenu();break;case"save as private gist":aigua.user?$(this).attr("class").indexOf("disabled")!=-1?alert("You cannot save a public gist as private."):aigua.saveAsUser(!1):alert("Please login to save your work under your GitHub username.");aigua.resetMenu();break;case"save as anonymous gist":aigua.saveAnonymously();aigua.resetMenu()}break;case"examples":r=aigua.isDirty()?confirm(aigua.areYouSureText):!0;r&&aigua.loadGist(t.attr("rel"));break;case"view":if(t.attr("class").indexOf("screenLayout")!=-1)aigua.switchLayout(t.text());else switch(t.text()){case"single page":r=aigua.isDirty()?confirm("Are you sure? Your unsaved changes will not be reflected when viewing as a single page."):!0;r&&window.open("/s"+location.pathname,"_blank");aigua.resetMenu();break;case"gallery":window.open("/gallery"+location.pathname,"_blank");aigua.resetMenu();break;case"stats":$("#stats").toggle();$("#stats").is(":visible")?t.addClass("selected"):t.removeClass("selected");aigua.resetMenu()}break;case"libraries":if(t.attr("class").indexOf("selected")==-1){t.addClass("selected");frames[0].livecoding.addJs(_.find(aigua.libraries,function(e){return e.name==t.text()}));aigua.setToDirty()}else{t.removeClass("selected");frames[0].livecoding.removeJs(_.find(aigua.libraries,function(e){return e.name==t.text()}));aigua.setToDirty()}aigua.resetMenu();break;case"resolution":aigua.switchResolution(t);break;case"help":switch(t.text()){case"source code":window.open("https://github.com/gabrielflorit/livecoding/","_blank");aigua.resetMenu();break;case"contact":window.open("http://twitter.com/gabrielflorit","_blank");aigua.resetMenu();break;case"about":$("#popup").fadeIn();$("#popup .about").fadeIn();aigua.resetMenu();break;case"keyboard shortcuts":$("#popup").fadeIn();$("#popup .keyboard").fadeIn();aigua.resetMenu()}}});$("#popup .close").click(function(e){e.preventDefault();aigua.hidePopup()})};if(localStorage["aigua.token"])aigua.logIn(localStorage["aigua.token"],r);else{aigua.logOut();r()}}};$("#iframeContainer").append('<iframe src="/iframe" scrolling="yes"></iframe>')});